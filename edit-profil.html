<script>
  if(!localStorage.getItem("id") )
  {
    location.replace("login.html");
  }
</script>
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Gérer profil - CiaoSpace</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-dark" id="ftco-navbar">
      <div class="container">
        <a class="navbar-brand" href="index.html"><img src="images/logoo.png" alt="logo" class="logo-dark" style="width: 10rem; height: 3rem;" /></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="oi oi-menu"></span> Menu
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
          <ul class="navbar-nav ml-auto">
            
            <li class="nav-item active"><a href="index.html" class="nav-link">Accueil</a></li>
            <li class="nav-item"><a href="search.html" class="nav-link">Rechercher</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">A propos</a></li>
            <li class="nav-item"><a href="partner.html" class="nav-link">Devenir partenaire</a></li>
            <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
            <li class="nav-item dropdown d-xl-inline-flex user-dropdown">
              <a class="nav-link dropdown-toggle" id="UserDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
                <i id="img"></i><span class="font-weight-normal" id="res"></span>
                    <script>  
                      var img = document.getElementById("img");
                      img.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="img-xs rounded-circle ml-2">`;
                      var res = document.getElementById("res");
                      res.innerHTML = localStorage.getItem("username");
                  
                 </script>
                  </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="UserDropdown">
                <div class="dropdown-header text-center">
                  <p id="photo"></p>
                  <script>
                    var photo = document.getElementById("photo");
                    photo.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="img-lg rounded-circle"   alt="Profile image" >`;
                  </script>
                  <h5 class="mb-1 mt-2 text-primary" id="nom" >
                    <script>
                      var nom = document.getElementById("nom");
                      nom.innerHTML = localStorage.getItem("username");
                  </script>
                </h5>
                  <p class="font-weight-light text-muted mb-0" id="re" >
                    <script>
                      var re = document.getElementById("re");
                      re.innerHTML = localStorage.getItem("email");
                  </script>
                  </p>
                </div>
                <a class="dropdown-item" href="edit-profil.html" ><i class="dropdown-item-icon icon-user text-primary mr-2"></i> Mon profil </a>
                <a class="dropdown-item"  onclick="logout();"><i class="dropdown-item-icon icon-power text-primary mr-2"></i>Déconnecter</a>
              </div>
            </li>
      
          </ul>
        </div>
      </div>
    </nav>
    <!-- END nav -->
    
          <!--Log Out-->
          <script>
            function logout()
            {
                var c  = window.confirm("Deconnecter");
                if (c == true)
                {
                    localStorage.clear();
                    location.replace("login.html");
                }
            }
          </script>

    <!-- END nav -->
    <section>
      <form onsubmit="return false;">
        <div class="room-section bg-light">
        <div class="container bg-light ">
          <div class="row" >
              <div class="col-md-4 border-right" >
                <div class="d-flex flex-column align-items-center text-center p-3 py-5" style="margin-top: -5%;">
                  
                  <p id="phot"></p>
                  <button onclick="send();">Modifier la photo de profil </button>
                  <br>
                  <script>
                    var phot = document.getElementById("phot");
                    phot.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="rounded-circle mt-4" height="150" width="140"   alt="Profile image" >`;
                  </script>

                  <span class="font-weight-bold" id="w"></span><span class="text-black-50" id="z"></span>
                  <script>
                    var w = document.getElementById("w");
                    w.innerHTML = localStorage.getItem("username");
                </script>
                <script>
                  var z = document.getElementById("z");
                  z.innerHTML = localStorage.getItem("email");
              </script>
                  
                </div>
              </div>
              
              <div class="col-md-5"  style="margin-top: 5%;">
                  
              
                      
                      <div class="row mt-2">
                          <div class="col-md-6"><label class="labels">Nom</label><input type="text" class="form-control" id="username" placeholder="" ></div>
                          <div class="col-md-6"><label class="labels">Prénom</label><input type="text" class="form-control" id="pre_cl" placeholder="" ></div>
                          <div class="col-md-12"><label class="labels">E-mail</label><input type="email" class="form-control" id="email" placeholder="" ></div>
                          <div class="col-md-12"><label class="labels">Mot de passe</label><input type="password" class="form-control" id="password" placeholder="" ></div>
                          <div class="col-md-12"><label class="labels">Numéro de mobile</label><input type="text" class="form-control" id="tel" placeholder="" ></div>
                          <div class="col-md-12"><label class="labels">Adresse</label><input type="text" class="form-control" id="adresse" placeholder="" ></div>
                          <div class="col-md-12"><label class="labels">Date de naissance</label><input type="text" class="form-control" id="dat_naissance" placeholder="" ></div>  
                      </div>
                      <br>
                      <button type="submit"  class="btn btn-primary btn-lg " onclick="update();">Terminé</button>
                      <a type="button" class="btn btn-light btn-lg" href="index.html">Annuler</a>
                      <br>
                      <br>
                      <br>
                  </div>
              </div>      
          </div>
      </div>
        </div>
    </form>
  </section>

  <script src="https://static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
          <script>
  
          function send(){
          
          var i = document.getElementById("image");
          
          const client = filestack.init('ACe2ZfVv5Qj2UDuYHsstnz'); 
          
          
          client.picker().open();
          
          
            const apikey = 'AhwZv4UE3RsuyRsgFdtz1z';
            //const client = filestack.init(apikey);
            const options = {
              maxFiles: 20,
              uploadInBackground: false,
              onOpen: () => console.log('opened!'),
              onUploadDone: (res) =>  i.value =res.filesUploaded[0].url ,
            };
            client.picker(options).open();
          
          
          
          }
          
          </script> 


    <!--Edit client-->
    <script>
      
      var c = localStorage.getItem("id");
     

      // Post a user
      var url3 = "http://192.168.43.93:3000/clients/" + c ;
      var xhr3 = new XMLHttpRequest();
      xhr3.open("GET", url3, true);
      

      xhr3.onload = function () {
          var clients = JSON.parse(xhr3.responseText);
          if (xhr3.readyState == 4 && xhr3.status == "200") {
              document.getElementById("username").value = clients.username;
              document.getElementById("pre_cl").value = clients.pre_cl;
              document.getElementById("email").value = clients.email;
              document.getElementById("password").value = clients.password;
              document.getElementById("tel").value = clients.tel;
              document.getElementById("adresse").value = clients.adresse;
              document.getElementById("dat_naissance").value = clients.dat_naissance;
              
             
          } else {

              console.log("error");
          }
      }

      xhr3.send(null);

      function update(){
         
        var c = localStorage.getItem("id");
              
                  var url = "http://192.168.43.93:3000/clients/"+c;
                                  
                  var data = {};
                  data.image  = document.getElementById("image").value;
                  data.username  = document.getElementById("username").value;
                  data.pre_cl  = document.getElementById("pre_cl").value;
                  data.email   = document.getElementById("email").value;
                  data.password    = document.getElementById("password").value;
                  data.tel    = document.getElementById("tel").value;
                  data.adresse    = document.getElementById("adresse").value;
                  data.dat_naissance    = document.getElementById("dat_naissance").value;
                  
                 
                                                    
                  var json = JSON.stringify(data);
                  var xhr = new XMLHttpRequest();
                  xhr.open("PUT", url, true);
                  xhr.setRequestHeader('Content-type','application/json; charset=utf-8');
                  xhr.onload = function () {
                      var clients = JSON.parse(xhr.responseText);
                      if (xhr.readyState == 4 && xhr.status == "200") {
                          alert("client modifier!");
                          location.replace("index.html");
                      } else {
                          console.error(clients);
                          location.replace("edit-profil.html");
                      }
                  }
                  xhr.send(json);
         
      }
  </script>

    <footer class="bg-dark text-center text-white">
      <!-- Grid container -->
      <div class="container p-4 pb-0">
        <!-- Section: Social media -->
        <section class="mb-4">
          <!-- Facebook -->
          <a class="btn btn-outline-light btn-floating m-1" href="https://www.facebook.com/" role="button">
            <i class="icon-facebook"></i></a>
    
          <!-- Google -->
          <a class="btn btn-outline-light btn-floating m-1" href="https://www.google.com/" role="button">
            <i class="icon-google"></i></a>
    
          <!-- Instagram -->
          <a class="btn btn-outline-light btn-floating m-1" href="https://www.instagram.com/?hl=fr" role="button">
            <i class="icon-instagram"></i></a>
        </section>
        <!-- Section: Social media -->
      </div>
      <!-- Grid container -->
    
      <!-- Copyright -->
      <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        © 2021 Copyright:
        <a class="text-white" href="https://ciaospace.com/">ciaospace.com</a>
      </div>
      <!-- Copyright -->
    </footer>



  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-migrate-3.0.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.waypoints.min.js"></script>
  <script src="js/jquery.stellar.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/jquery.animateNumber.min.js"></script>
  <script src="js/bootstrap-datepicker.js"></script>
  <script src="js/jquery.timepicker.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="js/google-map.js"></script>
  <script src="js/main.js"></script>
    
  </body>
</html>