<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Offre- Ciao Space</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700" rel="stylesheet">

    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">

    <link rel="stylesheet" href="css/aos.css">

    <link rel="stylesheet" href="css/ionicons.min.css">

    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">

    
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-dark" id="ftco-navbar">
      <div class="container">
        <a class="navbar-brand" href="index.html"><img src="images/logoo.png" alt="logo" class="logo-dark" style="width: 10rem; height: 3rem;" /></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="oi oi-menu"></span> Menu
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item  active"><a href="index.html" class="nav-link">Accueil</a></li>
            <li class="nav-item "><a href="search.html" class="nav-link">Rechercher</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">A propos</a></li>
            <li class="nav-item "><a href="partner.html" class="nav-link">Devenir partenaire</a></li>
            <li class="nav-item "><a href="contact.html" class="nav-link">Contact</a></li>

            <li class="nav-item dropdown  d-xl-inline-flex user-dropdown">
              <a class="nav-link dropdown-toggle" id="UserDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
                <i id="img"></i><span class="font-weight-normal" id="res"></span>
                    <script>  
                      var img = document.getElementById("img");
                      img.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="img-xs rounded-circle ml-2">`;
                      var res = document.getElementById("res");
                      res.innerHTML = localStorage.getItem("username");
                  
                 </script>
                  </a>
              <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="UserDropdown">
                <div class="dropdown-header text-center">
                  <p id="photo"></p>
                  <script>
                    var photo = document.getElementById("photo");
                    photo.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="img-lg rounded-circle"   alt="Profile image" >`;
                  </script>
                  <h5 class="mb-1 mt-2 text-primary" id="nom" >
                    <script>
                      var nom = document.getElementById("nom");
                      nom.innerHTML = localStorage.getItem("username");
                  </script>
                </h5>
                  <p class="font-weight-light text-muted mb-0" id="re" >
                    <script>
                      var re = document.getElementById("re");
                      re.innerHTML = localStorage.getItem("email");
                  </script>
                  </p>
                </div>
                <a class="dropdown-item" href="edit-profil.html" ><i class="dropdown-item-icon icon-user text-primary mr-2"></i> Mon profil </a>
                <a class="dropdown-item"  onclick="logout();"><i class="dropdown-item-icon icon-power text-primary mr-2"></i>Déconnecter</a>
              </div>
            </li>
      
          </ul>
        </div>
      </div>
    </nav>
    <!-- END nav -->
       <!--Log Out-->
       <script>
            function logout()
            {
                var c  = window.confirm("Deconnecter");
                if (c == true)
                {
                    localStorage.clear();
                    location.replace("login.html");
                }
            }
          </script>

       
          <section class=" contact-section bg-light">
            <div class="container bg-light">
              <h1 class="text" id="username"></h1>
              <p><i class="icon-map-marker mr-2"></i>Sousse</p>
              <style>
                .imag{
                  max-height: 450px;
                  max-width: 450px;
                }
              </style>
              <div class="row">

                <div class="col-md-6">
                    <div id="image"></div>
                
                </div>
      
                <div class="col-md-6" id="map4">

                          <!DOCTYPE html>
                          <html>
                            <head>
                              <title>Display location in map</title>
                              <style>
                            
                              </style>
                            </head>
                            <body>
                            
                          
                              <div id="demo2" style="width: 100%; height: 390px;">
                                
                              </div>
                              <script src="https://maps.google.com/maps/api/js?sensor=false">
                                
                              </script>
                            
                            </body>
                          </html>		

                </div>

              </div>
            </div>
          

            <div class="services bg-light" >
              <div class="container" style="margin-top: -9%;">
                <div class="row no-gutters">
                  <div class="col-md-4 ftco-animate py-5 nav-link-wrap aside-stretch">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                      <a class="nav-link px-4 active" id="v-pills-master-tab" data-toggle="pill" href="#v-pills-master" role="tab" aria-controls="v-pills-master" aria-selected="true"> DESCRIPTION </a>
        
                      <a class="nav-link px-4" id="v-pills-buffet-tab" data-toggle="pill" href="#v-pills-buffet" role="tab" aria-controls="v-pills-buffet" aria-selected="false"> L'OFFRE COMPREND</a>
        
                      <a class="nav-link px-4" id="v-pills-fitness-tab" data-toggle="pill" href="#v-pills-fitness" role="tab" aria-controls="v-pills-fitness" aria-selected="false"> INFOS PARTENAIRE</a>
                    </div>
                  </div>
    
                  <div class="col-md-8 ftco-animate p-4 p-md-5 d-flex align-items-center">
                    
                    <div class="tab-content pl-md-5" id="v-pills-tabContent">
        
                      <div class="tab-pane fade show active" id="v-pills-master" role="tabpanel" aria-labelledby="v-pills-master-tab">
                        <div class="row">
                          <div class="col-sm">
                            <p class="lead" id="description"></p>
                            
                          </div>
                         
        
                      </div>
                      </div>
        
                      <div class="tab-pane fade" id="v-pills-buffet" role="tabpanel" aria-labelledby="v-pills-buffet-tab">
                        <p class="lead" id="prix">
                          <br>
                          <h5 id="datedeb"></h5>
          
                          <h5 id="periode"></h5> 
                        </p>
                      
                      </div>
        
                      <div class="tab-pane fade" id="v-pills-fitness" role="tabpanel" aria-labelledby="v-pills-fitness-tab" >
                        <p class="lead">
                          <h4>ADRESSE</h4>
                          <h6 id="adresse"></h6> 
                        </p>
                        <p><a href="" class="btn btn-primary"> <i class="icon-location-arrow mr-2"></i>Directions</a>
                        <a id="tel"></a></p>
                        <p class="lead">
                          <h4>LIENS UTILES</h4> 
                          <a id="lien_fb"></a> <a id="lien_insta"></a>
                        </p>
                      </div>
      
                    </div>
                  </div>
                </div>
              </div>
            </div>

          <script>
            var url_string = window.location.href
            var url = new URL(url_string);
            var c = url.searchParams.get("id");
            console.log(c);
      
            // Post a user
            var url3 = "http://192.168.43.93:3000/offres/" + c ;
            var xhr3 = new XMLHttpRequest();
            xhr3.open("GET", url3, true);
         
      
            xhr3.onload = function () {
            var offres = JSON.parse(xhr3.responseText);
            console.log(offres)
    
            if (xhr3.readyState == 4 && xhr3.status == "200") {
                console.table(offres);   
                document.getElementById("image").innerHTML = `<img src="` +offres.image+ `" class="imag"  alt="" >`;
                document.getElementById("prix").innerHTML   = "20% de réduction à partir de "+ offres.prix +"DT de consommation :";
                document.getElementById("datedeb").innerHTML      = "- Offre valable sur toute la carte depuis " + offres.datedeb;
                document.getElementById("periode").innerHTML   = "-Offre valable " + offres.periode + " jours";
                document.getElementById("adresse").innerHTML   = offres.adresse ;
                document.getElementById("username").innerHTML   =  `<h3>` +offres.username+ `</h3>`;
                document.getElementById("lien_fb").innerHTML   = `<a class="btn btn-outline-primary btn-primary m-1" href="` +offres.lien_fb+ `"  role="button"> <i class="icon-facebook"></i></a>`;
                document.getElementById("lien_insta").innerHTML   = `<a class="btn btn-outline-primary btn-primary m-1" href="` +offres.lien_insta+ `"  role="button"> <i class="icon-instagram"></i></a>`;
                document.getElementById("description").innerHTML   = offres.description;
              //  document.getElementById("categorie").innerHTML   = offres.categorie;
               // document.getElementById("email").innerHTML   = offres.email;
                document.getElementById("tel").innerHTML   =`<a onclick="apell:` +offres.tel+ `"  class="btn btn-primary" ><i class="icon-phone2 mr-2"></i>Appeler</a>`;
             //   alert(offres.x)


                latt = offres.x;
            long = offres.y;
            var lattlong = new google.maps.LatLng(latt, long);
            var OPTions = {
              center: lattlong,
              zoom: 15,
              mapTypeControl: true,
              navigationControlOptions: {style:google.maps.NavigationControlStyle.SMALL}
            }
            var mapg = new google.maps.Map(document.getElementById("demo2"), OPTions);
            var markerg =
            new google.maps.Marker({position:lattlong, map:mapg, title:"You are here!"});
      
      
                } else {
                console.log("error");
                }
            }
      
            xhr3.send(null);
        </script>  
          
          
          <div class="container"  style="margin-top: -17%;" >
            <div class="container mt-5">
              <div class="d-flex justify-content-center row">
                  <div class="col-md-12">
              
                        <div class="d-flex flex-column comment-section">
                          <div id="listp"></div>
                
                            <div class="bg-light p-2">
                                <div class="d-flex flex-row align-items-start">
                                  <p id="photoo"></p>
                                  <script>
                                    var photoo = document.getElementById("photoo");
                                    photoo.innerHTML =`<img src="` +localStorage.getItem("image")+ `" class="rounded-circle"  width="40" >`;
                                  </script>
                               <form onsubmit="return false;"></form>
                                  <textarea class="form-control ml-1 shadow-none textarea" id="continue"></textarea>
                                  <input id="image" type="hidden" class="form-control"  required>
                                  <input id="username" type="hidden" class="form-control"  required>
                                </div>
                                <div class="mt-2 text-right">
                                  <button onclick="add();" class="btn btn-primary btn-sm shadow-none" type="submit" >Post comment</button> 
                                  <button class="btn btn-outline-primary btn-sm ml-1 shadow-none" type="button">Cancel</button>
 
                                </div>
                              </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
          </div>
          

        </section>
          
        <script>
          // Create a request variable and assign a new XMLHttpRequest object to it.
          var request = new XMLHttpRequest()
              
          // Open a new connection, using the GET request on the URL endpoint
          request.open('GET', 'http://192.168.43.93:3000/avis_offres', true)
          
          
          request.onload = function() {
              // Begin accessing JSON data here
              var data = JSON.parse(this.response)
              
              console.log(data);
              var j = 1;
              var ee = document.getElementById("listp");
              data.forEach(i => {
                  console.log(i._id);
                  
                  ch =  `   
                   <div class="d-flex flex-column comment-section">
                            <div class="bg-white p-2">
                                <div class="d-flex flex-row user-info"><img class="rounded-circle" src="`+i.image +`" width="40">
                                    <div class="d-flex flex-column justify-content-start ml-2"><span class="d-block font-weight-bold name">`+i.username  +`</span><span class="date text-black-50">Shared publicly -  ` + i.createdAt.substring(0,10) + `</span></div>
                                </div>
                                <div class="mt-2">
                                    <p class="comment-text">`+i.continue +`</p>
                                </div>
                            </div>
                            <div class="bg-white">
                                <div class="d-flex flex-row fs-12">
                                    
                                    <div class="like p-2 cursor"><i class="fa fa-commenting-o"></i><span class="ml-1">Commenter</span></div>
                                    
                                </div>
                            </div>
                        </div>
                      
                     
                  `;
                
                  ee.insertAdjacentHTML('beforeend',ch);
              
              })
          }
              
          // Send request
          request.send()    
      </script>

<script>

  function add(){
      // Post a contact
  var url = "http://192.168.43.93:3000/avis_offres";
  
  var data = {};
// récupération des données dans la variable data . 
  
data.continue  = document.getElementById("continue").value;
data.image = localStorage.getItem("image") ;
data.username = localStorage.getItem("username") ;

  
  
var json = JSON.stringify(data);
    var xhr = new XMLHttpRequest(); // definir une request de connection standard js 
    xhr.open("POST", url, true);  // choisir la méthode post comme méthode d'accès au serveur pour avoir la possibilité d'envoyer les données au serveur .
    xhr.setRequestHeader('Content-type','application/json; charset=utf-8');
    xhr.onload = function () {
      var avis_offres = JSON.parse(xhr.responseText);
      if (xhr.readyState == 4 && xhr.status == "200") {
        console.table(avis_offres);
  
       alert(" commentaire ajouter ");
         
        location.reload();
    
      } else {
        alert(avis_offres.message);
        console.table(avis_offres);
      
      }
    }
    xhr.send(json);
    }

</script>


       
    
       


    <section class="instagram">
      <div class="container-fluid">
        <div class="row no-gutters justify-content-center pb-5">
          <div class="col-md-7 text-center heading-section ftco-animate">
            <h2><span class="icon-instagram"></span> Instagram</h2>
          </div>
        </div>
        <div class="row no-gutters">
          <div class="col-sm-12 col-md ftco-animate">
            <a href="images/insta-4.jpg" class="insta-img image-popup" style="background-image: url(images/insta-4.jpg);">
              <div class="icon d-flex justify-content-center">
                <span class="icon-instagram align-self-center"></span>
              </div>
            </a>
          </div>
          <div class="col-sm-12 col-md ftco-animate">
            <a href="images/insta-2.jpg" class="insta-img image-popup" style="background-image: url(images/insta-2.jpg);">
              <div class="icon d-flex justify-content-center">
                <span class="icon-instagram align-self-center"></span>
              </div>
            </a>
          </div>
          <div class="col-sm-12 col-md ftco-animate">
            <a href="images/insta-3.jpg" class="insta-img image-popup" style="background-image: url(images/insta-3.jpg);">
              <div class="icon d-flex justify-content-center">
                <span class="icon-instagram align-self-center"></span>
              </div>
            </a>
          </div>
          <div class="col-sm-12 col-md ftco-animate">
            <a href="images/insta-6.jpg" class="insta-img image-popup" style="background-image: url(images/insta-7.jpg);">
              <div class="icon d-flex justify-content-center">
                <span class="icon-instagram align-self-center"></span>
              </div>
            </a>
          </div>
          <div class="col-sm-12 col-md ftco-animate">
            <a href="images/insta-5.jpg" class="insta-img image-popup" style="background-image: url(images/insta-5.jpg);">
              <div class="icon d-flex justify-content-center">
                <span class="icon-instagram align-self-center"></span>
              </div>
            </a>
          </div>
        </div>
      </div>
    </section>

    <footer class="bg-dark text-center text-white">
      <!-- Grid container -->
      <div class="container p-4 pb-0">
        <!-- Section: Social media -->
        <section class="mb-4">
          <!-- Facebook -->
          <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
            ><i class="icon-facebook"></i
          ></a>
    
          <!-- Google -->
          <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
            ><i class="icon-google"></i
          ></a>
    
          <!-- Instagram -->
          <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button"
            ><i class="icon-instagram"></i
          ></a>
        </section>
        <!-- Section: Social media -->
      </div>
      <!-- Grid container -->
    
      <!-- Copyright -->
      <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        © 2021 Copyright:
        <a class="text-white" href="https://ciaospace.com/">ciaospace.com</a>
      </div>
      <!-- Copyright -->
    </footer>
  

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-migrate-3.0.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.waypoints.min.js"></script>
  <script src="js/jquery.stellar.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/jquery.animateNumber.min.js"></script>
  <script src="js/bootstrap-datepicker.js"></script>
  <script src="js/jquery.timepicker.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="js/google-map.js"></script>
  <script src="js/main.js"></script>
    
  </body>
</html>